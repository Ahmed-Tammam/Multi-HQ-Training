<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">
    <title>Multi-HQ Pilot Manager</title>
    <style>
        /* --- BASE STYLES --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            color: #002147; margin: 0; padding: 0; background: #525659; padding-top: 140px; 
        }
        
        .app-dashboard {
            position: fixed; top: 0; left: 0; right: 0;
            background: #1a1a1a; color: white;
            padding: 10px; z-index: 10000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; gap: 10px;
        }
        .dashboard-row { display: flex; justify-content: space-between; align-items: center; }
        .app-logo { height: 40px; width: 40px; border-radius: 8px; margin-right: 10px; vertical-align: middle; }
        .app-title { font-weight: bold; font-size: 18px; color: #fff; }
        
        .student-select { padding: 10px; font-size: 16px; border-radius: 5px; flex-grow: 1; margin-right: 10px; }
        
        .btn { padding: 10px 15px; font-size: 14px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; color: #fff; text-transform: uppercase; }
        .btn-new { background: #2980b9; }
        .btn-save { background: #27ae60; }
        .btn-pdf { background: #f1c40f; color: #000; }
        .btn-del { background: #c0392b; }

        /* --- PAGE LAYOUT --- */
        .page { 
            background: white; box-sizing: border-box; margin: 20px auto; padding: 15mm;
            border: 1px solid #ccc; box-shadow: 0 8px 16px rgba(0,0,0,0.3); width: 210mm; min-height: 296mm;
            position: relative; page-break-after: always;
        }

        .logo-stamp { height: 60px; width: auto; margin-right: 15px; vertical-align: bottom; }

        @media screen and (max-width: 850px) {
            .page { width: 96%; padding: 10px; margin: 10px auto; min-height: auto; }
            body { padding-top: 130px; }
            .logo-stamp { height: 40px; }
        }

        .header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 4px solid #002147; padding-bottom: 10px; margin-bottom: 20px; }
        .header-left { display: flex; align-items: flex-end; }
        .title-main { font-size: 28px; font-weight: 900; line-height: 0.9; }
        .title-sub { text-align: right; font-weight: bold; color: #444; font-size: 11px; }
        
        /* THE BLUE BAR STYLE */
        .section-bar { background: #002147; color: white; padding: 6px 10px; font-weight: bold; margin-top: 15px; text-transform: uppercase; font-size: 12px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 5px; table-layout: fixed; }
        td, th { border: 1px solid #ccc; padding: 6px; vertical-align: middle; font-size: 11px; }
        th { background: #eee; text-align: left; }
        
        input[type="text"], input[type="date"] { width: 98%; border: none; border-bottom: 1px solid #ddd; font-size: 12px; outline: none; background: transparent; }
        textarea { width: 100%; border: none; resize: none; font-size: 12px; line-height: 1.4; outline: none; background: transparent; }

        /* --- SIGNATURE CANVAS --- */
        .sig-container { border: 1px dashed #ccc; background: #fafafa; position: relative; height: 60px; }
        canvas.signature-pad { width: 100%; height: 100%; touch-action: none; cursor: crosshair; }
        .clear-sig { position: absolute; top: 0; right: 0; font-size: 8px; background: #ddd; padding: 2px; cursor: pointer; border: none; }

        /* --- STRICT A4 PRINTING --- */
        @media print {
            @page { margin: 0; size: A4; } /* Force A4 size and remove browser margins */
            html, body { width: 210mm; height: 297mm; margin: 0; padding: 0; background: white !important; }
            .app-dashboard, .clear-sig { display: none !important; }
            
            .page { 
                width: 210mm !important; 
                height: 296mm !important; /* 1mm safety buffer */
                margin: 0 !important; 
                padding: 10mm 15mm !important; /* Standard document margins */
                border: none !important; 
                box-shadow: none !important; 
                page-break-after: always !important;
                page-break-inside: avoid !important;
                overflow: hidden !important;
                float: none !important;
            }
            
            /* Ensure background colors print */
            .section-bar { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            th { background-color: #eee !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <div class="app-dashboard">
        <div class="dashboard-row">
            <div><img src="icon.png" class="app-logo" alt="Icon"><span class="app-title">MULTI-HQ MANAGER</span></div>
            <div><button class="btn btn-pdf" onclick="window.print()">üñ®Ô∏è PDF</button></div>
        </div>
        <div class="dashboard-row">
            <select id="studentList" class="student-select" onchange="loadStudent(this.value)"><option value="">-- Select Student --</option></select>
            <button class="btn btn-new" onclick="createNewStudent()">+ New</button>
            <button class="btn btn-save" onclick="saveCurrentStudent()">üíæ Save</button>
            <button class="btn btn-del" onclick="deleteStudent()">üóëÔ∏è</button>
        </div>
    </div>

    <div class="page">
        <div class="header">
            <div class="header-left"><img src="stamp.png" class="logo-stamp" alt="Logo"><div class="title-main">MULTI-HQ</div></div>
            <div class="title-sub">TRAINING FILE<br>Pilot Record</div>
        </div>
        <table>
            <tr><td>Name:</td><td><input type="text" id="stu_name"></td><td>Lic. No.:</td><td><input type="text" id="stu_lic"></td></tr>
            <tr><td>Start Date:</td><td><input type="date" id="stu_sdate"></td><td>Total Hours:</td><td><input type="text" id="stu_thours"></td></tr>
            <tr><td>Membership:</td><td colspan="3"><input type="text" id="stu_memb"></td></tr>
        </table>
        <div class="section-bar">Type of Training</div>
        <table>
            <tr><td>Group 1 <input type="checkbox" id="t_g1"></td><td>Group 3 <input type="checkbox" id="t_g3"></td><td>Multi Eng <input type="checkbox" id="t_me"></td><td>Time Building <input type="checkbox" id="t_tb"></td></tr>
            <tr><td>Single <input type="checkbox" id="t_s"></td><td>Multi <input type="checkbox" id="t_m"></td><td colspan="2">Single & Multi <input type="checkbox" id="t_sm"></td></tr>
        </table>
        <div class="section-bar">Document Review</div>
        <table>
            <tr><td>Lic Valid: <input type="checkbox" id="doc_l"></td><td>Med Valid: <input type="checkbox" id="doc_m"></td><td>Logbook: <input type="checkbox" id="doc_lb"></td></tr>
            <tr><td>Lic Exp: <input type="date" id="doc_lexp"></td><td colspan="2">Med Exp: <input type="date" id="doc_mexp"></td></tr>
        </table>
    </div>

    <div class="page">
        <div class="header">
            <div class="header-left"><img src="stamp.png" class="logo-stamp" alt="Logo"><div class="title-main">MULTI-HQ</div></div>
            <div class="title-sub">TECHNICAL KNOWLEDGE<br>Discussion Record</div>
        </div>
        
        <div class="section-bar">Technical Knowledge Checklist</div>
        
        <div style="display: flex; gap: 15px;">
            <table style="width:50%">
                <tr><th>Topic</th><th style="width:30px">‚úî</th></tr>
                <tr><td>Flight Management</td><td><input type="checkbox" id="tk1"></td></tr>
                <tr><td>Problem Solving</td><td><input type="checkbox" id="tk2"></td></tr>
                <tr><td>Decision Making</td><td><input type="checkbox" id="tk3"></td></tr>
                <tr><td>Situational Awareness</td><td><input type="checkbox" id="tk4"></td></tr>
                <tr><td>Communication</td><td><input type="checkbox" id="tk5"></td></tr>
                <tr><td>Workload Management</td><td><input type="checkbox" id="tk6"></td></tr>
                <tr><td>CDFA</td><td><input type="checkbox" id="tk7"></td></tr>
                <tr><td>Stable Approach</td><td><input type="checkbox" id="tk8"></td></tr>
                <tr><td>Wx reports & forecasts</td><td><input type="checkbox" id="tk9"></td></tr>
                <tr><td>Graphic Area Forecast</td><td><input type="checkbox" id="tk10"></td></tr>
                <tr><td>Surface Analysis chart</td><td><input type="checkbox" id="tk11"></td></tr>
                <tr><td>Radar & Satellite</td><td><input type="checkbox" id="tk12"></td></tr>
                <tr><td>WxCam</td><td><input type="checkbox" id="tk13"></td></tr>
                <tr><td>SIG Wx Chart</td><td><input type="checkbox" id="tk14"></td></tr>
                <tr><td>Winds & Temp Aloft</td><td><input type="checkbox" id="tk15"></td></tr>
                <tr><td>SIGMETS</td><td><input type="checkbox" id="tk16"></td></tr>
                <tr><td>PIREPS</td><td><input type="checkbox" id="tk17"></td></tr>
                <tr><td>NOTAMS</td><td><input type="checkbox" id="tk18"></td></tr>
                <tr><td>WAAS NOTAMS</td><td><input type="checkbox" id="tk19"></td></tr>
                <tr><td>RAIM Predictions</td><td><input type="checkbox" id="tk20"></td></tr>
                <tr><td>ALT WX Mins</td><td><input type="checkbox" id="tk21"></td></tr>
                <tr><td>Takeoff Minima</td><td><input type="checkbox" id="tk22"></td></tr>
                <tr><td>Takeoff ALT</td><td><input type="checkbox" id="tk23"></td></tr>
                <tr><td>Icing Encounters</td><td><input type="checkbox" id="tk24"></td></tr>
            </table>
            <table style="width:50%">
                <tr><th>Topic</th><th style="width:30px">‚úî</th></tr>
                <tr><td>Landing Minima</td><td><input type="checkbox" id="tk25"></td></tr>
                <tr><td>Reduced/Low VIS ops</td><td><input type="checkbox" id="tk26"></td></tr>
                <tr><td>Approach Ban</td><td><input type="checkbox" id="tk27"></td></tr>
                <tr><td>Approach Charts</td><td><input type="checkbox" id="tk28"></td></tr>
                <tr><td>Use of Automation</td><td><input type="checkbox" id="tk29"></td></tr>
                <tr><td>Dep Proc SID</td><td><input type="checkbox" id="tk30"></td></tr>
                <tr><td>Arrival Proc STAR</td><td><input type="checkbox" id="tk31"></td></tr>
                <tr><td>Descend VIA</td><td><input type="checkbox" id="tk32"></td></tr>
                <tr><td>RUNWAY Markings</td><td><input type="checkbox" id="tk33"></td></tr>
                <tr><td>Holding</td><td><input type="checkbox" id="tk34"></td></tr>
                <tr><td>RNAV App</td><td><input type="checkbox" id="tk35"></td></tr>
                <tr><td>ILS App</td><td><input type="checkbox" id="tk36"></td></tr>
                <tr><td>VOR App</td><td><input type="checkbox" id="tk37"></td></tr>
                <tr><td>NDB App</td><td><input type="checkbox" id="tk38"></td></tr>
                <tr><td>Missed App</td><td><input type="checkbox" id="tk39"></td></tr>
                <tr><td>Transition to Lndg</td><td><input type="checkbox" id="tk40"></td></tr>
                <tr><td>EMER PROC</td><td><input type="checkbox" id="tk41"></td></tr>
                <tr><td>Engine Failure</td><td><input type="checkbox" id="tk42"></td></tr>
                <tr><td>Elec Sys Failure</td><td><input type="checkbox" id="tk43"></td></tr>
                <tr><td>Radio Failure</td><td><input type="checkbox" id="tk44"></td></tr>
                <tr><td>Vacuum Sys Failure</td><td><input type="checkbox" id="tk45"></td></tr>
                <tr><td>Anti-ice Failure</td><td><input type="checkbox" id="tk46"></td></tr>
                <tr><td>GPS Failure</td><td><input type="checkbox" id="tk47"></td></tr>
                <tr><td>De-icing Sys Failure</td><td><input type="checkbox" id="tk48"></td></tr>
            </table>
        </div>
    </div>

    <div id="records-wrapper"></div>

    <script>
        const wrapper = document.getElementById('records-wrapper');
        for(let i=1; i<=20; i++) {
            const div = document.createElement('div');
            div.className = 'page';
            div.innerHTML = `
                <div class="header">
                    <div class="header-left"><img src="stamp.png" class="logo-stamp"><div class="title-main">RECORD</div></div>
                    <div class="title-sub">#${i}</div>
                </div>
                <div class="record-container">
                    <table>
                        <tr><td>Exercise:</td><td><input type="text" id="r${i}_ex"></td><td>Date:</td><td><input type="date" id="r${i}_date"></td></tr>
                        <tr><td>AC REG:</td><td><input type="text" id="r${i}_reg"></td><td>Time:</td><td><input type="text" id="r${i}_time"></td></tr>
                        <tr><td>Total Time:</td><td colspan="3"><input type="text" id="r${i}_tt"></td></tr>
                        <tr><td colspan="4" style="background:#eee; font-weight:bold">NOTES:</td></tr>
                        <tr><td colspan="4"><textarea id="r${i}_notes" rows="22"></textarea></td></tr>
                        <tr><td><b>Grade:</b></td><td colspan="3">1 <input type="radio" name="g${i}" id="g${i}_1"> 2 <input type="radio" name="g${i}" id="g${i}_2"> 3 <input type="radio" name="g${i}" id="g${i}_3"> 4 <input type="radio" name="g${i}" id="g${i}_4"></td></tr>
                        <tr><td><b>Signature:</b></td><td colspan="3" class="sig-container"><button class="clear-sig" onclick="clearSig('sig${i}')">Clear</button><canvas id="sig${i}" class="signature-pad"></canvas></td></tr>
                    </table>
                </div>`;
            wrapper.appendChild(div);
        }

        // --- SIGNATURE PAD LOGIC ---
        function initSignatures() {
            document.querySelectorAll('.signature-pad').forEach(canvas => {
                const ctx = canvas.getContext('2d');
                let drawing = false;

                const getPos = (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    return { x: (clientX - rect.left) * (canvas.width / rect.width), y: (clientY - rect.top) * (canvas.height / rect.height) };
                };

                const start = (e) => { drawing = true; ctx.beginPath(); const p = getPos(e); ctx.moveTo(p.x, p.y); e.preventDefault(); };
                const move = (e) => { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); e.preventDefault(); };
                const stop = () => { drawing = false; };

                // Handle resizing gracefully
                const resize = () => { canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; };
                resize();
                // window.addEventListener('resize', resize); // Optional: can reset sigs on resize, so maybe skip

                ctx.lineWidth = 2; ctx.lineCap = 'round'; ctx.strokeStyle = '#000';

                canvas.addEventListener('mousedown', start); canvas.addEventListener('mousemove', move); window.addEventListener('mouseup', stop);
                canvas.addEventListener('touchstart', start, {passive: false}); canvas.addEventListener('touchmove', move, {passive: false}); window.addEventListener('touchend', stop);
            });
        }
        function clearSig(id) { const c = document.getElementById(id); c.getContext('2d').clearRect(0,0,c.width,c.height); }

        // --- DATABASE LOGIC ---
        const STORAGE_KEY = "pilot_db_v2";
        let currentStudentId = null;

        function getDB() { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); }
        function saveDB(data) { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

        function refreshDropdown() {
            const db = getDB(); const select = document.getElementById('studentList');
            select.innerHTML = '<option value="">-- Select Student --</option>';
            Object.keys(db).forEach(id => {
                const opt = document.createElement('option'); opt.value = id; opt.textContent = db[id].name + " (" + id + ")";
                if(id === currentStudentId) opt.selected = true;
                select.appendChild(opt);
            });
        }

        function createNewStudent() {
            const id = prompt("License Number:"); if(!id) return;
            const db = getDB(); if(db[id]) return alert("Exists!");
            currentStudentId = id; saveCurrentStudent(); 
        }

        function saveCurrentStudent() {
            const id = document.getElementById('stu_lic').value.trim(); if(!id) return;
            const formData = { sigs: {} };
            document.querySelectorAll('input, textarea').forEach(el => {
                if(el.type === 'checkbox' || el.type === 'radio') { if(el.checked) formData[el.id] = true; } 
                else { formData[el.id] = el.value; }
            });
            document.querySelectorAll('.signature-pad').forEach(c => { formData.sigs[c.id] = c.toDataURL(); });
            const db = getDB(); db[id] = { name: document.getElementById('stu_name').value, data: formData };
            saveDB(db); refreshDropdown(); alert("Saved!");
        }

        function loadStudent(id) {
            if(!id) return; const db = getDB(); const student = db[id];
            if(student) {
                currentStudentId = id;
                document.querySelectorAll('input, textarea').forEach(el => { if(el.type === 'checkbox' || el.type === 'radio') el.checked = false; else el.value = ''; });
                Object.keys(student.data).forEach(key => {
                    const el = document.getElementById(key);
                    if(el) { if(el.type === 'checkbox' || el.type === 'radio') el.checked = true; else el.value = student.data[key]; }
                });
                Object.keys(student.data.sigs || {}).forEach(sid => {
                    const c = document.getElementById(sid); const ctx = c.getContext('2d');
                    const img = new Image(); img.onload = () => ctx.drawImage(img, 0, 0); img.src = student.data.sigs[sid];
                });
            }
        }
        
        function deleteStudent() {
            if(!currentStudentId) return;
            if(confirm("Delete?")) { const db = getDB(); delete db[currentStudentId]; saveDB(db); currentStudentId = null; refreshDropdown(); }
        }

        window.onload = () => { initSignatures(); refreshDropdown(); };
    </script>
</body>
</html>