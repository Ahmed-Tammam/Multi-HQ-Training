<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Pilot Training Record</title>
    <style>
        /* --- BASE STYLES --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            color: #002147; 
            margin: 0; padding: 0; 
            background: #525659; /* Dark background */
        }
        
        /* --- CONTROL PANEL --- */
        .control-panel { 
            position: sticky; top: 0; 
            background: #002147; 
            padding: 12px; 
            display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; 
            z-index: 9999; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        .btn { 
            padding: 12px 20px; 
            font-size: 14px; font-weight: bold; 
            border: none; border-radius: 6px; 
            cursor: pointer; text-transform: uppercase; color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .btn:active { transform: scale(0.96); }
        
        .btn-html { background-color: #27ae60; } /* Green */
        .btn-pdf  { background-color: #f1c40f; color: #002147; } /* Yellow */
        .btn-clear{ background-color: #c0392b; } /* Red */

        /* --- PAGE LAYOUT --- */
        .page { 
            background: white; 
            box-sizing: border-box; 
            margin: 20px auto; 
            padding: 15mm;
            border: 1px solid #ccc;
            /* SHADOW to make pages distinct */
            box-shadow: 0 8px 16px rgba(0,0,0,0.3); 
        }

        /* --- RESPONSIVE LOGIC --- */
        /* If on a big screen (Computer), lock to A4 size */
        @media screen and (min-width: 850px) {
            .page { width: 210mm; min-height: 297mm; }
        }
        /* If on iPad/Phone, fit to screen width */
        @media screen and (max-width: 849px) {
            .page { width: 95%; min-height: auto; padding: 10px; margin: 10px auto; }
            body { background: #333; }
            /* Make inputs easier to tap */
            input[type="checkbox"], input[type="radio"] { transform: scale(1.5); margin: 5px; }
        }

        /* --- HEADER & TITLES --- */
        .header { 
            display: flex; justify-content: space-between; align-items: flex-end; 
            border-bottom: 4px solid #002147; 
            padding-bottom: 10px; margin-bottom: 20px; 
        }
        .title-main { font-size: 28px; font-weight: 900; line-height: 0.9; }
        .title-sub { text-align: right; font-weight: bold; color: #444; font-size: 11px; }
        
        .section-bar { 
            background: #002147; color: white; 
            padding: 6px 10px; font-weight: bold; 
            margin-top: 15px; text-transform: uppercase; font-size: 12px; 
        }

        /* --- TABLES & INPUTS --- */
        table { width: 100%; border-collapse: collapse; margin-top: 5px; table-layout: fixed; }
        td, th { border: 1px solid #ccc; padding: 6px; vertical-align: middle; font-size: 11px; }
        th { background: #eee; text-align: left; }
        
        input[type="text"], input[type="date"] { 
            width: 98%; border: none; border-bottom: 1px solid #ddd; 
            font-family: -apple-system, sans-serif; font-size: 12px; outline: none; background: transparent;
            border-radius: 0; /* Fix iOS rounded corners */
        }
        textarea { 
            width: 100%; border: none; resize: none; 
            font-family: -apple-system, sans-serif; font-size: 12px; line-height: 1.4; outline: none; background: transparent;
        }

        .record-container { border: 2px solid #002147; margin-top: 15px; padding: 10px; }

        /* --- PRINT MODE (ALWAYS A4) --- */
        @media print {
            body { background: white; }
            .control-panel { display: none; }
            .page { 
                width: 210mm; height: 297mm; 
                margin: 0; border: none; box-shadow: none; 
                page-break-after: always; 
                padding: 15mm; /* Ensure padding returns for print */
            }
            input::placeholder { color: transparent; }
            /* Hide the visual spacing between pages when printing */
            .page { margin-bottom: 0; }
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <button class="btn btn-html" onclick="saveDirectly()">üíæ Save HTML (Edit Later)</button>
        <button class="btn btn-pdf" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
        <button class="btn btn-clear" onclick="clearForm()">üßπ Clear</button>
    </div>

    <div class="page">
        <div class="header">
            <div class="title-main">MULTI-HQ</div>
            <div class="title-sub">TRAINING FILE<br>Pilot Record</div>
        </div>

        <table>
            <tr>
                <td style="width:15%">Name:</td>
                <td><input type="text" id="stu_name" value=""></td>
                <td style="width:15%">Lic. No.:</td>
                <td><input type="text" id="stu_lic" value=""></td>
            </tr>
            <tr>
                <td>Start Date:</td>
                <td><input type="date" id="stu_sdate" value=""></td>
                <td>Total Hours:</td>
                <td><input type="text" id="stu_thours" value=""></td>
            </tr>
            <tr>
                <td>Membership:</td>
                <td colspan="3"><input type="text" id="stu_memb" value=""></td>
            </tr>
        </table>

        <div class="section-bar">Type of Training</div>
        <table>
            <tr>
                <td>Group 1 <input type="checkbox" id="t_g1"></td>
                <td>Group 3 <input type="checkbox" id="t_g3"></td>
                <td>Multi Eng <input type="checkbox" id="t_me"></td>
                <td>Time Building <input type="checkbox" id="t_tb"></td>
            </tr>
            <tr>
                <td>Single <input type="checkbox" id="t_s"></td>
                <td>Multi <input type="checkbox" id="t_m"></td>
                <td colspan="2">Single & Multi <input type="checkbox" id="t_sm"></td>
            </tr>
        </table>

        <div class="section-bar">Document Review</div>
        <table>
            <tr>
                <td>Lic Valid: <input type="checkbox" id="doc_l"></td>
                <td>Med Valid: <input type="checkbox" id="doc_m"></td>
                <td>Logbook: <input type="checkbox" id="doc_lb"></td>
            </tr>
            <tr>
                <td>Lic Exp: <input type="date" id="doc_lexp"></td>
                <td colspan="2">Med Exp: <input type="date" id="doc_mexp"></td>
            </tr>
        </table>

        <div class="section-bar">Technical Knowledge Discussion</div>
        <div style="display: flex; gap: 10px;">
            <table style="width:50%">
                <tr><th>Topic</th><th style="width:30px">‚úî</th></tr>
                <tr><td>Flight Management</td><td style="text-align:center"><input type="checkbox" id="tk1"></td></tr>
                <tr><td>Problem Solving</td><td style="text-align:center"><input type="checkbox" id="tk2"></td></tr>
                <tr><td>Decision Making</td><td style="text-align:center"><input type="checkbox" id="tk3"></td></tr>
                <tr><td>Situational Awareness</td><td style="text-align:center"><input type="checkbox" id="tk4"></td></tr>
                <tr><td>Communication</td><td style="text-align:center"><input type="checkbox" id="tk5"></td></tr>
                <tr><td>Workload Management</td><td style="text-align:center"><input type="checkbox" id="tk6"></td></tr>
                <tr><td>CDFA / Stable App</td><td style="text-align:center"><input type="checkbox" id="tk7"></td></tr>
                <tr><td>Wx Reports / GAF</td><td style="text-align:center"><input type="checkbox" id="tk8"></td></tr>
                <tr><td>Radar & Satellite</td><td style="text-align:center"><input type="checkbox" id="tk9"></td></tr>
                <tr><td>NOTAMS / RAIM</td><td style="text-align:center"><input type="checkbox" id="tk10"></td></tr>
            </table>
            <table style="width:50%">
                <tr><th>Topic</th><th style="width:30px">‚úî</th></tr>
                <tr><td>Landing Minima</td><td style="text-align:center"><input type="checkbox" id="tk11"></td></tr>
                <tr><td>Reduced VIS Ops</td><td style="text-align:center"><input type="checkbox" id="tk12"></td></tr>
                <tr><td>Approach Ban</td><td style="text-align:center"><input type="checkbox" id="tk13"></td></tr>
                <tr><td>SID / STAR</td><td style="text-align:center"><input type="checkbox" id="tk14"></td></tr>
                <tr><td>RNAV / ILS / VOR</td><td style="text-align:center"><input type="checkbox" id="tk15"></td></tr>
                <tr><td>Engine Failure</td><td style="text-align:center"><input type="checkbox" id="tk16"></td></tr>
                <tr><td>Elec / Radio Fail</td><td style="text-align:center"><input type="checkbox" id="tk17"></td></tr>
                <tr><td>Vacuum / GPS Fail</td><td style="text-align:center"><input type="checkbox" id="tk18"></td></tr>
                <tr><td>Icing / De-icing</td><td style="text-align:center"><input type="checkbox" id="tk19"></td></tr>
                <tr><td>Emergency Proc.</td><td style="text-align:center"><input type="checkbox" id="tk20"></td></tr>
            </table>
        </div>
    </div>

    <div id="records-wrapper"></div>

    <script>
        // --- 1. GENERATE PAGES ---
        const wrapper = document.getElementById('records-wrapper');
        for(let i=1; i<=20; i++) {
            const div = document.createElement('div');
            div.className = 'page';
            div.innerHTML = `
                <div class="header">
                    <div class="title-main">MULTI-HQ</div>
                    <div class="title-sub">Record #${i}</div>
                </div>
                <div class="record-container">
                    <table>
                        <tr>
                            <td style="width:15%">Exercise:</td><td><input type="text" id="r${i}_ex" value=""></td>
                            <td style="width:15%">Date:</td><td><input type="date" id="r${i}_date" value=""></td>
                        </tr>
                        <tr>
                            <td>AC REG:</td><td><input type="text" id="r${i}_reg" value=""></td>
                            <td>Time:</td><td><input type="text" id="r${i}_time" value=""></td>
                        </tr>
                        <tr>
                            <td>Total Time:</td><td colspan="3"><input type="text" id="r${i}_tt" value=""></td>
                        </tr>
                        <tr><td colspan="4" style="background:#eee; font-weight:bold">NOTES:</td></tr>
                        <tr><td colspan="4"><textarea id="r${i}_notes" rows="28"></textarea></td></tr>
                        <tr>
                            <td><b>Grade:</b></td>
                            <td colspan="3">
                                1 <input type="radio" name="g${i}" id="g${i}_1"> 
                                2 <input type="radio" name="g${i}" id="g${i}_2"> 
                                3 <input type="radio" name="g${i}" id="g${i}_3"> 
                                4 <input type="radio" name="g${i}" id="g${i}_4">
                            </td>
                        </tr>
                        <tr><td><b>Signature:</b></td><td colspan="3" style="height:40px"></td></tr>
                    </table>
                </div>
            `;
            wrapper.appendChild(div);
        }

        // --- 2. DIRTY FLAG ---
        let isDirty = false;
        document.body.addEventListener('input', () => isDirty = true);
        window.onbeforeunload = function() { if (isDirty) return "Unsaved changes!"; };

        // --- 3. SAVE DIRECTLY (Works on Desktop; Fallback on iPad) ---
        async function saveDirectly() {
            // Bake inputs into attributes
            const docClone = document.documentElement.cloneNode(true);
            const inputs = docClone.querySelectorAll('input');
            const originalInputs = document.querySelectorAll('input');
            originalInputs.forEach((orig, idx) => {
                if (orig.type === 'checkbox' || orig.type === 'radio') {
                    if (orig.checked) inputs[idx].setAttribute('checked', 'checked');
                    else inputs[idx].removeAttribute('checked');
                } else {
                    inputs[idx].setAttribute('value', orig.value);
                }
            });
            const textareas = docClone.querySelectorAll('textarea');
            const originalTextareas = document.querySelectorAll('textarea');
            originalTextareas.forEach((orig, idx) => {
                textareas[idx].innerHTML = orig.value;
            });

            const fileContent = "<!DOCTYPE html>\n" + docClone.outerHTML;
            const studentName = document.getElementById('stu_name').value.trim() || 'Student_Log';

            // Try Advanced Save (Desktop Chrome)
            if (window.showSaveFilePicker) {
                try {
                    const handle = await window.showSaveFilePicker({
                        suggestedName: `${studentName}.html`,
                        types: [{ description: 'HTML File', accept: {'text/html': ['.html']} }],
                    });
                    const writable = await handle.createWritable();
                    await writable.write(fileContent);
                    await writable.close();
                    isDirty = false;
                    alert("Saved!");
                    return;
                } catch (err) {
                    // If user cancels or not supported, use fallback
                }
            }
            
            // iPad / Fallback Method
            const blob = new Blob([fileContent], {type: "text/html"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${studentName}.html`;
            a.click();
            isDirty = false;
        }

        // --- 4. CLEAR FORM ---
        function clearForm() {
            if(confirm("Are you sure? This will wipe all data.")) {
                document.querySelectorAll('input').forEach(el => {
                    if(el.type === 'checkbox' || el.type === 'radio') el.checked = false;
                    else el.value = '';
                });
                document.querySelectorAll('textarea').forEach(el => el.value = '');
                isDirty = false;
            }
        }
    </script>
</body>
</html>